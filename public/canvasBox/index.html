<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Canvas animation</title>
  <style media="screen">
    html,
    body,
    canvas {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
  </style>
</head>

<body>
  <canvas id="canvas" width="2000" height="2000"></canvas>
  <script src="canvas.js"></script>
  <script>
    const canvas = document.getElementById("canvas");
    const canvasCtx = canvas.getContext("2d");

    const drawCircles = (x, y, r, color) => {
      canvasCtx.beginPath();
      canvasCtx.arc(x, y, r, 0, 2 * Math.PI, false);
      canvasCtx.fillStyle = color;
      canvasCtx.fill();
    }

    const render = (dataLength, circleStructSize) => {
      const circlesDatas = new Int32Array(Module.HEAP32.buffer, _getCircles(canvas.width, canvas.height), dataLength);
      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);

      for (let i = 0; i < circlesDatas.length; i += circleStructSize) {
        const x = circlesDatas[i];
        const y = circlesDatas[i + 1];
        const r = circlesDatas[i + 2];
        const cr = circlesDatas[i + 3];
        const cb = circlesDatas[i + 4];
        const cg = circlesDatas[i + 5];
        const ca = 0.75;
        drawCircles(x, y, r, `rgba(${cr},${cg},${cb},${ca})`);
      }

      window.requestAnimationFrame(() => {
        render(dataLength, circleStructSize);
      });
    }
  </script>
</body>

</html>